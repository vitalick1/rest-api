<?php
/**
 * Created by PhpStorm.
 * User: vitalie
 * Date: 6/16/15
 * Time: 4:14 PM
 */

namespace REST\Controller;

use Zend\Http\Headers;
use Zend\Mvc\Controller\AbstractRestfulController;
use REST\Service\User;

use Zend\Mvc\Router\Http\TreeRouteStack;


class UserController extends AbstractRestfulController {

    protected $acceptCriteria = array(
        'Zend\View\Model\JsonModel' => array(
            'application/json',
        ),
    );

    /**
     * @var User
     */
    protected $userService;


    public function get($id)
    {
        $model = $this->acceptableViewModelSelector($this->acceptCriteria);

        $model->setVariables($this->getUserService()->getUserById($id));

        return $model;
    }

    public function create($data)
    {
        $data = json_decode($this->getRequest()->getContent(), true);

        $data = $this->userService->save($data);

        $responseHeaders = new Headers();

        $userRoute = $this->url()->fromRoute('user', ['id' => $data['id']]);
        $responseHeaders->addHeaderLine('Location', $userRoute);

        $this->getResponse()->setHeaders($responseHeaders);
        $this->getResponse()->setStatusCode(303);

        return $this->acceptableViewModelSelector($this->acceptCriteria);
    }

    public function delete($id)
    {
        return parent::delete($id); // TODO: Change the autogenerated stub
    }

    public function deleteList($data)
    {
        return parent::deleteList($data); // TODO: Change the autogenerated stub
    }

    public function getList()
    {
        $listUsers = $this->getUserService()->getList();

        $model = $this->acceptableViewModelSelector($this->acceptCriteria);
        $model->list = $listUsers;

        return $model;
    }

    public function update($id, $data)
    {
        $data = json_decode($this->getRequest()->getContent(), true);

        $data['id'] = $id;

        $data = $this->userService->save($data);

        $model = $this->acceptableViewModelSelector($this->acceptCriteria);

        $model->setVariables($data);

        return $model;
    }


    /**
     * @return array
     */
    public function getAcceptCriteria()
    {
        return $this->acceptCriteria;
    }

    /**
     * @param array $acceptCriteria
     */
    public function setAcceptCriteria($acceptCriteria)
    {
        $this->acceptCriteria = $acceptCriteria;
    }

    /**
     * @return User
     */
    public function getUserService()
    {
        return $this->userService;
    }

    /**
     * @param User $userService
     */
    public function setUserService($userService)
    {
        $this->userService = $userService;
    }


}